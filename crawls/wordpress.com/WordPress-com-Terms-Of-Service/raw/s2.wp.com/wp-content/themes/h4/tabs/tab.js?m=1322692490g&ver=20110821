var jq=jQuery;wpcom_homedash={request:false,active_tab:false,init:function(){this.unload();jq("#homenav li a").live('click.wpcom_homedash',function(e){e.preventDefault();window.location.hash='!/'+jq(this).parent('li').attr('class').replace(' current','')+'/';wpcom_homedash.click_tab(jq(this).parent('li'));});jq('a.load-page').live('click.wpcom_homedash',function(e){e.preventDefault();if(jq(this).attr('rel').length){wpcom_homedash.load_page(jq(this).attr('rel'),jq(this).attr('class').replace('load-page ','').replace(' selected','').replace('load-page',''));}});},click_tab:function(tab){this.active_tab=tab.attr('class');jq(document).trigger('tab_clicked.wpcom');tab.children('a').addClass('loading');wpcom_homedash.load_tab(tab);},load_tab:function(tab,callback){if(typeof wpcom_homedash.request=='object')
wpcom_homedash.request.abort();if(!tab.length)return false;jq('#homenav li').removeClass('current');wpcom_homedash.request=jq.get('/wp-admin/admin-ajax.php',{action:'wpcom_load_tab','template':tab.attr('class')},function(response){tab.addClass('current');jq('#homenav li a').removeClass('loading');jq.cookie('wpcom_active_tab',tab.attr('class').replace(' current',''));if(jq.browser.msie){jq('div#tab-content').html(response);}else{jq('div#tab-content').fadeOut('fast',function(){jq(this).html(response);jq('div#tab-content').fadeIn('fast');tab.children('a').removeClass('loading');var page=wpcom_homedash.get_qs_param('page');if(page)
wpcom_homedash.load_page(jq('a.'+page).attr('rel'),page);else
window.location.hash='!/'+tab.attr('class').replace(' current','')+'/';});}
jq(document).trigger('tab_loaded.wpcom');wpcom_homedash.quantcast(wpcom_homedash.active_tab);});},load_page:function(page_slug,hash,callback){if(typeof wpcom_homedash.request=='object')
wpcom_homedash.request.abort();if(undefined!=hash&&hash){jq(document).trigger('pageLoading.wpcom_homedash');if(-1!=hash.search('topic-')){wpcom_reader.load_topic_page(jq('a.'+hash))
return;}
if(undefined!=page_slug&&page_slug)
window.location.hash='!/'+jq('li.current').attr('class').replace(' current','')+'/'+hash+'/';}else
window.location.hash='!/'+jq('li.current').attr('class').replace(' current','')+'/';if(undefined!=page_slug&&page_slug){wpcom_homedash.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':page_slug},function(result){wpcom_homedash.render_page(result,callback);});}},render_page:function(html,callback){jq('.tab-content').fadeOut('fast',function(){jq('.tab-content').html(html);jq('.tab-content').fadeIn('fast',function(){wp_remote_avatar_fetch();jq.scrollTo(0,500,{easing:'easeout'});jq(document).trigger('pageLoaded.wpcom_homedash');if(typeof callback=='function')callback.call(this);});});},unload:function(){jq('#homenav li a, a.load-page').die('click.wpcom_homedash');},get_qs_param:function(param){var qs=window.location.hash.split('/');if('tab'==param){if(undefined==qs[1])
return false;else
return qs[1];}
if(undefined==qs[2])
return false;else{if('topic'==qs[2])
return qs[2]+'-'+qs[3];else
return qs[2];}},titleize:function(str){str=str.replace('-',' ',str);return(str+'').replace(/^([a-z])|\s+([a-z])/g,function($1){return $1.toUpperCase();});},quantcast:function(tab){jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_newdash_quantcast_code','tab':tab},function(statcode){if('infinite_scroll'==tab)
jq('div.subscriptions:last-child div.sub:last-child').after(statcode)
else
jq('div#tab-content').append(statcode);});}}
wpcom_homedash.init();var wpcom_reader={request:false,actions:['addtopic'],init:function(){wpcom_reader.unload();wpcom_reader.check_page(wpcom_homedash.get_qs_param('page'));this.highlight_nav();jq("#reader .sidebar a").live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.nav_click(jq(this));});jq('#reader .sidebar a.load-topic-page').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.load_topic_page(jq(this));});jq('.actions .like').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.submit_like(jq(this));});jq('.actions .reblog').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.show_reblog_box(jq(this));});jq('.actions .reblogged').live('click.wpcom_reader',function(e){e.preventDefault();});jq('#reblog-box a.cancel').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.cancel_reblog(jq(this));});jq('#reblog-box input[type=submit]').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.submit_reblog(jq(this));});jq('.topic a.follow').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.follow_blog(jq(this));});jq('.topic a.following').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.unfollow_blog(jq(this));});jq('input#add-topic-text').live('focus.wpcom_reader',function(e){e.preventDefault();if('Add a Topic'==jq(this).val())
jq(this).val('');jq('a.add-topic').fadeIn('fast');jq('span.errortipwrap').fadeOut('fast');});jq('input#add-topic-text').live('blur.wpcom_reader',function(e){e.preventDefault();if('Add a Topic'==jq(this).val()||''==jq(this).val()){jq('a.add-topic').fadeOut('fast');jq(this).val('Add a Topic');}});jq('a.add-topic').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.add_topic(jq(this));});jq('input#add-topic-text').live('keyup.wpcom_reader',function(e){jq('span.errortipwrap').fadeOut('fast');var code=(e.keyCode?e.keyCode:e.which);if(e.type=='keyup'&&code!=13)
return false;wpcom_reader.add_topic(jq('a.add-topic'));return false;});jq('a.remove-topic').live('click.wpcom_reader',function(e){e.preventDefault();wpcom_reader.remove_topic(jq(this));});jq(document).bind('pageLoading.wpcom_homedash',function(){if(jq('li.current').hasClass('read')){var page=wpcom_homedash.get_qs_param('page');if(page&&-1==jq.inArray(page,wpcom_reader.actions))
wpcom_reader.nav_click(jq('a.'+page));}});jq('a.show-suggestions').live('click.wpcom_reader',function(){this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':'suggested'},function(response){jq('#tab-content').html(response);});});},check_page:function(page){if(page){switch(page){case'addtopic':var topic=window.location.hash.split('/');jq('#add-topic-text').val(wpcom_homedash.titleize(topic[3]));wpcom_reader.add_topic(jq('a.add-topic'));break;}}else{wpcom_homedash.load_page('subscriptions.read.blogs',false,function(){wpcom_infinite_scroll.init();});}},highlight_nav:function(){if(-1!=location.href.search('&p=')){tmp=location.href.split('=');if(tmp&&tmp[1]){jq("#reader .sidebar ul li a").each(function(){if(tmp[1]==jq(this).attr('rel'))
jq(this).addClass('selected');else
jq(this).removeClass('selected');});}}},nav_click:function(link){if(!link.hasClass('remove-topic')&&!link.hasClass('add-topic')){jq("#reader .sidebar ul li a").each(function(){jq(this).removeClass('selected');});link.addClass('selected');}
jq('span.loading').remove();jq('a.remove-topic').show();if(!link.hasClass('edit')&&!link.hasClass('remove-topic')&&!link.hasClass('add-topic')){if(!link.parent().children('span.loading').length){link.after('<span class="loading"></span>');link.parent().children('span.loading').hide().fadeIn('fast');link.parent().children('a').not('a.selected').fadeOut('fast');}
jq(document).bind('pageLoaded.wpcom_homedash',function(){link.parent().children('span.loading').fadeOut('fast');link.parent().children('a').not('a.selected').fadeIn('fast');});}
if(!link.hasClass('remove-topic')&&!link.hasClass('add-topic'))
wpcom_reader.load_classes(link.attr('rel'));},load_classes:function(link_rel){if(!link_rel)
return;wpcom_infinite_scroll.unload();switch(link_rel){case'subscriptions.read.blogs':case'subscriptions.read.p2s':case'subscriptions.read.topic':case'subscriptions.read.liked':case'subscriptions.read.comment-liked':wpcom_infinite_scroll.init();break;case'subscriptions.manage.blogs':wpcom_reader_manage.init();break;case'subscriptions.manage.friends':wpcom_friend_finder.init();break;case'subscriptions.settings':wpcom_reader_global_settings.init();break;}
jq.query.set('p',link_rel);},load_topic_page:function(link){if(typeof this.request=='object')
this.request.abort();if(typeof wpcom_homedash.request=='object')
wpcom_homedash.request.abort();var topic_id=link.attr('id').split('-');topic_id=topic_id[1];window.location.hash='!/'+jq('li.current').attr('class').replace(' current','')+'/topic/'+link.attr('class').replace('load-topic-page ','').replace(' selected','').replace('topic-','')+'/';this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':'subscriptions.read.topic.'+topic_id},function(result){wpcom_homedash.render_page(result);});},submit_like:function(link){if(typeof this.request=='object')
this.request.abort();link.fadeOut(100,function(){link.removeClass('like');link.addClass('liked');link.html('<span></span>Liked');link.fadeIn(100);});var nonce=link.attr('href').split('_wpnonce=');nonce=nonce[1];var ids=link.parent().attr('id').split(',');this.request=jq.post('/wp-admin/admin-ajax.php',{'action':'like_it','cookie':encodeURIComponent(document.cookie),'_wpnonce':nonce,'blog_id':ids[0],'post_id':ids[1]});},show_reblog_box:function(link){if(link.hasClass('priv'))
return false;jq('#reblog-box textarea').val('Your comments (optional)');jq('a.reblog').removeClass('selected');link.addClass('selected');jq('#reblog-box p.response').remove();jq('#reblog-box div.submit, #reblog-box div.submit span.canceltext').show();jq('#reblog-box div.submit input[type=submit]').prop('disabled',false);if(','!=link.parents('span.actions').attr('id'))
jq('#reblog-box input#ids').val(link.parents('span.actions').attr('id'));jq('#reblog-box input#blog-url').val(link.parents('div.sub-body-content').children('h4').children('span').children('a.blog-url').attr('href'));jq('#reblog-box input#blog-title').val(link.parents('div.sub-body-content').children('h4').children('span').children('a.blog-url').html());jq('#reblog-box input#post-url').val(link.parents('div.sub-body-content').children('h4').children('a.post-title').attr('href'));jq('#reblog-box input#post-title').val(link.parents('div.sub-body-content').children('h4').children('a.post-title').html());jq('#reblog-box').hide();link.parents('div.sub-body-content').append(jq('#reblog-box'));jq('#reblog-box').fadeIn('fast',function(){var height=jq(window).height()/2.2;jq.scrollTo(jq('#reblog-box'),500,{easing:'easeout',offset:height*-1});});},submit_reblog:function(input){if(typeof this.request=='object')
this.request.abort();input.attr('value','Reblogging...');input.prop('disabled',true);jq('#reblog-box div.submit span.canceltext').fadeOut(150,function(){input.after('<span class="loading"></span>');});if(jq('#reblog-box input#ids').val()=='')
ids='';else
ids=jq('#reblog-box input#ids').val();this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'subs_post_reblog','cookie':encodeURIComponent(document.cookie),'ids':ids,'blog_id':jq('#reblog-box select').val(),'blog_url':jq('#reblog-box input#blog-url').val(),'blog_title':jq('#reblog-box input#blog-title').val(),'post_url':jq('#reblog-box input#post-url').val(),'post_title':jq('#reblog-box input#post-title').val(),'note':jq('#reblog-box textarea').val(),'_wpnonce':jq('#reblog-box #_wpnonce').val()},function(result){jq('#reblog-box').css({height:jq('#reblog-box').height()+'px'}).slideUp(150,function(){jq('#reblog-box').parents('div.sub-body-content').children('span.actions').children('a.reblog').fadeOut(150,function(){jq(this).html('<span></span>Reblogged').removeClass('reblog').addClass('reblogged').fadeIn(150);});jq('#reblog-box span.loading').remove();input.attr('value','Post Reblog');});jq('#reblog-box').parents('div.sub-body-content').children('p.post-meta').fadeOut(150,function(){jq(this).prepend('<span class="reblogged"><span></span>You reblogged this</span> &middot; ').fadeIn(150);});},'json');},cancel_reblog:function(link){jq('#reblog-box').fadeOut('fast');jq('a.reblog').removeClass('selected');},follow_blog:function(link){if(typeof this.request=='object')
this.request.abort();var nonce=link.attr('href').split('_wpnonce=');nonce=nonce[1];var blog_id=link.attr('id').split('-');blog_id=blog_id[1];link.fadeOut('fast',function(){link.addClass('following').removeClass('follow').html('Following');link.fadeIn('fast');})
this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'ab_subscribe_to_blog','_wpnonce':nonce,'blog_id':blog_id,'source':'friend_finder'},function(response){if('object'==typeof response.errors)
link.removeClass('following').addClass('follow').html('Follow');});},unfollow_blog:function(link){if(typeof this.request=='object')
this.request.abort();var nonce=link.attr('href').split('_wpnonce=');nonce=nonce[1];var blog_id=link.attr('id').split('-');blog_id=blog_id[1];link.fadeOut('fast',function(){link.removeClass('following').addClass('follow').html('Follow');link.fadeIn('fast');})
this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'ab_unsubscribe_from_blog','_wpnonce':nonce,'blog_id':blog_id},function(response){if('object'==typeof response.errors)
link.removeClass('following').addClass('follow').html('Follow');});},add_topic:function(link){if(typeof this.request=='object')
this.request.abort();var topic_name=link.parents('li').children('input').val();if('Add a Topic'==topic_name||!topic_name||''==topic_name||undefined==topic_name)
return false;jq('a.add_topic').hide();jq('span.loading').remove();jq('a.remove-topic').fadeIn('fast');link.fadeOut('fast',function(){link.after('<span class="loading"></span>');link.parent().children('span.loading').hide().fadeIn('fast');});this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'add_topic','topic_name':topic_name,'_wpnonce':jq('input#manage_topics').val()},function(r){if(!r.error&&r.result){jq('span.errortipwrap').remove();if(!jq('li.add').length){link.parent().after('<li class="add"><input type="text" id="add-topic-text" value="Add a Topic" /><a class="add-topic" href="">Add</a></li>');jq('li.add').hide().slideDown('fast',function(){link.parent('li').replaceWith(r.result);jq('li.add').removeClass('add');if(r.topic_id){wpcom_reader.load_topic_page(jq('a#t-'+r.topic_id));wpcom_reader.nav_click(jq('a#t-'+r.topic_id));}});}}else{link.before('<span class="errortipwrap"><span class="errortiptext">'+r.error+'</span></span>');jq('span.errortipwrap').css({'width':'auto','white-space':'nowrap','left':'10px'}).fadeIn('fast');link.parent().children('span.loading').fadeOut('fast').remove();link.fadeIn('fast');}},'json');},remove_topic:function(link){if(link.parents('li').children('a.selected').length){wpcom_homedash.load_page('subscriptions.read.blogs',false);this.nav_click(jq('.sidebar li:first-child a:first-child'));}
link.parent().children('a.remove-topic').addClass('removing').html('Removing...');var topic_id=link.attr('id').split('-');topic_id=topic_id[1];this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'remove_topic','topic_id':topic_id,'_wpnonce':jq('input#manage_topics').val()},function(response){if('-1'!=response)
link.parents('li').slideUp('fast');});},unload:function(){jq('#reader .sidebar a').die('click.wpcom_reader');jq('.actions .like').die('click.wpcom_reader');jq('.actions .reblog').die('click.wpcom_reader');jq('#reblog-box a.cancel').die('click.wpcom_reader');jq('#reblog-box input[type=submit]').die('click.wpcom_reader');jq('input#add-topic-text').die('focus.wpcom_reader');jq('input#add-topic-text').die('blur.wpcom _reader');jq('a.add-topic').die('click.wpcom_reader');jq('input#add-topic-text').die('keyup.wpcom_reader');jq('a.remove-topic').die('click.wpcom_reader');jq('a.show-suggestions').die('click.wpcom_reader');}}
var wpcom_reader_manage={request:false,init:function(){this.unload();jq("input#addblog_submit").live('click.wpcom_reader_manage',function(e){e.preventDefault();wpcom_reader_manage.follow(jq(this));});jq("a.unsub").live('click.wpcom_reader_manage',function(e){e.preventDefault();wpcom_reader_manage.unfollow(jq(this));});jq("input#addblog").live('keyup.wpcom_reader_manage',function(e){var code=(e.keyCode?e.keyCode:e.which);if(e.type=='keyup'&&code!=13)
return false;wpcom_reader_manage.follow();return false;});jq("select.email_setting").live('change.wpcom_reader_manage',function(){wpcom_reader_manage.change_email_delivery(jq(this));});jq("input.jabber_setting").live('click.wpcom_reader_manage',function(){wpcom_reader_manage.change_im_delivery(jq(this));});jq("form#manage-subs").live('submit.wpcom_reader_manage',function(){return false;});},follow:function(link){this.abort_request();jq("span#subscribe-loading").fadeIn('fast');jq('span.errortipwrap').fadeOut(150);this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'subscribe_to_blog','blog_url':jq('input#addblog').val(),'_wpnonce':jq('input#subs').val()},function(response){jq('tr#nosubs').remove();if(response.substr(0,2)!='-1'){jq('tr.header').after(response);jq('tr.new').hide();jq('tr.new').fadeIn(function(){wp_remote_avatar_fetch();});jq('input#addblog').val('http://');}else{jq('span.errortiptext').html(response.substr(2,response.length));jq('span.errortipwrap').fadeIn(150);}
jq('input#addblog').focus();jq("span#subscribe-loading").hide();});},unfollow:function(link){this.abort_request();var parent=link.parents('tr');parent.fadeOut();var blog_ids=parent.attr('id').substr(5,parent.attr('id').length);if(blog_ids.length)
blog_ids+',';this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'unsubscribe_from_blog','blog_ids':blog_ids,'blog_url':parent.children('td.blogname').children('h4').children('a.blogurl').attr('rel'),'_wpnonce':jq('input#subs').val()});},change_email_delivery:function(dropdown){this.abort_request();var parent_td=dropdown.parents('td');jq.get('/wp-admin/admin-ajax.php',{'action':'email_delivery_change','blog_id':parent_td.parents('tr').attr('id'),'setting':dropdown.val(),'_wpnonce':jq('input#delivery').val()});},change_im_delivery:function(checkbox){this.abort_request();var parent_td=checkbox.parents('td');jq.get('/wp-admin/admin-ajax.php',{'action':'jabber_delivery_change','blog_id':parent_td.parents('tr').attr('id'),'setting':checkbox.is(':checked'),'_wpnonce':jq('input#delivery').val()},function(r){});},abort_request:function(){if(typeof wpcom_reader_manage.request=='object'){wpcom_reader_manage.request.abort();jq("span#subscribe-loading").hide();}},unload:function(){jq("input#addblog_submit").die('click.wpcom_reader_manage');jq("a.unsub").die('click.wpcom_reader_manage');jq("input#addblog").die('keyup.wpcom_reader_manage');jq("select.email_setting").die('change.wpcom_reader_manage');jq("input.selectall").die('click.wpcom_reader_manage');jq("form#manage-subs").die('submit.wpcom_reader_manage');}}
var wpcom_reader_global_settings={init:function(){this.unload();jq('input#subs-settings-save').live('click.wpcom_reader_global_settings',function(){wpcom_reader_global_settings.save(jq(this));});},save:function(input){jq('span#settings-saved').remove();jq('span.saved, span.loading').remove();input.after('<span class="loading"></span>');input.prop('disabled',true).val('Saving...');setTimeout(function(){link.val('Save Settings').prop('disabled',false).after('<span id="settings-saved">Settings were saved. <a class="load-page" rel="subscriptions.read.blogs" href="#subs">Back to my subscriptions</a></span>');jq('span.loading').remove();},1500);var jabber_setting=(jq('input#default_jabber_enable').is(':checked'))?1:0;jq.get('/wp-admin/admin-ajax.php',{'action':'subs_save_settings','cookie':encodeURIComponent(document.cookie),'_wpnonce':jq('input#subs_nonce').val(),'email_setting':jq('select#default_email').val(),'jabber_setting':jabber_setting,'mail_option':jq('select#mail_option').val(),'delivery_hour':jq('select#delivery_hour').val(),'delivery_day':jq('select#delivery_day').val(),'blocked':jq('input#blocked').is(':checked')},function(){jq('span.saved, span.loading').remove();input.after('<span class="saved">&nbsp; Settings saved.</span>');input.prop('disabled',false).val('Save Settings');});},unload:function(){jq("input#subs-settings-save").die('click.wpcom_reader_global_settings');}}
var wpcom_friend_finder={init:function(){this.unload();jq('#ff-services a').live('click.wpcom_friend_finder',function(e){e.preventDefault();wpcom_friend_finder.start_auth(jq(this));});jq('#found-friends a.follow').live('click.wpcom_friend_finder',function(e){e.preventDefault();wpcom_reader.follow_blog(jq(this));});jq('#found-friends a.following').live('click.wpcom_friend_finder',function(e){e.preventDefault();wpcom_reader.unfollow_blog(jq(this));});},start_auth:function(link){jq('#found-friends').fadeOut('fast');jq(wpcom_external_auth.init(link.attr('id')));},unload:function(){jq('#ff-services a').die('click.wpcom_friend_finder');jq('#found-friends a.follow').die('click.wpcom_friend_finder');jq('#found-friends a.following').die('click.wpcom_friend_finder');}}
var wpcom_reader_suggestions={init:function(){this.unload();jq('#suggestions').live('submit.wpcom_reader_suggestions',function(e){e.preventDefault();var selected_topics=jq("#suggestions input:checked").map(function(i,e){return e.value});if(selected_topics.length==0){selected_topics=["-1"];}
this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':'suggested','topics':jq.makeArray(selected_topics)},function(response){var subs=jq('#subscriptions ');subs.fadeOut('fast',function(){subs.html(response);subs.fadeIn('fast');});});});jq('.kingmaker-suggested-cat input').hide();jq('.kingmaker-suggested-cat').live('click.wpcom_reader_suggestions',function(e){e.preventDefault();jq(this).toggleClass('selected');var selected=jq(this).hasClass('selected');jq(this).find('input').attr('checked',selected);});jq('.kingmaker-blog').live('click.wpcom_reader_suggestions',function(e){e.preventDefault();jq(this).toggleClass('selected');});jq('#selected-suggestions').live('submit.wpcom_reader_suggestions',function(e){this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':'suggested','follow':jq.makeArray(wpcom_reader_suggestions.selected())},function(response){wpcom_homedash.click_tab(jq('#homenav li.read'));});});jq('.kingmaker-suggested-submit a.skip').live('click.wpcom_reader_suggestions',function(e){e.preventDefault();this.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':'suggested','skip':true},function(response){wpcom_homedash.click_tab(jq('#homenav li.read'));});});},unload:function(){jq('#suggestions').die('submit.wpcom_reader_suggestions');jq('.kingmaker-blog').die('click.wpcom_reader_suggestions');jq('.kingmaker-suggested-cat').die('click.wpcom_reader_suggestions');jq('#selected-suggestions').die('submit.wpcom_reader_suggestions');jq('.kingmaker-suggested-submit a.skip').die('click.wpcom_reader_suggestions');},selected:function(){return jq('.kingmaker-blog.selected').map(function(i,e){return e.id.replace('kingmaker-','');});}}
var wpcom_external_auth=jQuery.extend(wpcom_external_auth,{cookies:{facebook:'wpc_fbc',twitter:'wpc_tc'},popups:{facebook:',height=400,width=600',twitter:',height=515,width=600'},ext_win:false,ext_win_check:false,init:function(service){clearInterval(this.ext_win_check);if(this.readCookie(this.cookies[service])){jq('#subs-loading').fadeIn('fast');this.doExternalLoggedIn(service);}else{wpcom_external_auth.ext_win=window.open('https://public-api.wordpress.com/connect/?action=request&service='+service+'&scope=basic','highconn','status=0,toolbar=0,location=1,menubar=0,directories=0,resizable=1,scrollbars=0'+this.popups[service]);wpcom_external_auth.ext_win_check=setInterval(function(){wpcom_external_auth.pollExternalWindow(service)},100);}},doExternalLoggedIn:function(service){clearInterval(this.ext_win_check);var data=this.getServiceData(service);if('object'!==typeof data)
return;if('facebook'!=service&&'twitter'!=service)
return;jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_ff_query_'+service},function(response){if("-1"==response){jq('#subs-loading').fadeOut('fast');wpcom_external_auth.clearCookie(service);wpcom_external_auth.init(service);return;}
jq('#found-friends').fadeOut('fast',function(){jq(this).html(response);jq(this).fadeIn('fast',function(){wp_remote_avatar_fetch();});});jq('#subs-loading').fadeOut('fast');});},doExternalCanceled:function(service){},doExternalLogout:function(service){this.clearCookie(service);this.doExternalCanceled(service,true);},getServiceData:function(service){var data=this.readCookie(this.cookies[service]);if(null===data||'undefined'===typeof data.access_token||!data.access_token){return false;}
return data;},pollExternalWindow:function(service){if(this.readCookie(this.cookies[service])){clearInterval(this.ext_win_check);wpcom_external_auth.ext_win.close();this.init(service);}else{if(this.ext_win.closed||!this.ext_win)
this.doExternalCanceled(service);}},readCookie:function(c){var nameEQ=c+"=",ca=document.cookie.split(';'),i,char,num,chunk,pairs,pair,cookie_data;for(i=0;i<ca.length;i++){char=ca[i];while(char.charAt(0)===' '){char=char.substring(1,char.length);}
if(char.indexOf(nameEQ)===0){chunk=char.substring(nameEQ.length,char.length);pairs=chunk.split('&');cookie_data={};for(num=pairs.length-1;num>=0;num--){pair=pairs[num].split('=');cookie_data[pair[0]]=decodeURIComponent(pair[1]);}
return cookie_data;}}
return null;},writeCookie:function(name,value,days,domain){var expires;if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}else{expires="";}
if(domain){domain="; domain="+domain;}else{domain='';}
document.cookie=name+"="+value+expires+"; path=/"+domain;},clearCookie:function(service){var hostname;if(-1!==window.location.hostname.indexOf('.wordpress.com')){hostname='wordpress.com';}else{hostname=window.location.hostname;}
this.writeCookie(this.cookies[service],'',-10,hostname);}});var wpcom_infinite_scroll={per_page:false,page_num:false,page_html:false,request:false,init:function(){this.unload();wpcom_infinite_scroll.per_page=(jq.query.get('per_page'))?jq.query.get('per_page'):7;wpcom_infinite_scroll.page_num=(jq.query.get('page_num'))?jq.query.get('page_num'):2;this.load();jq(window).bind('scroll.wpcom_infinite_scroll',wpcom_infinite_scroll.scroll_handler);},scroll_handler:function(){if(wpcom_infinite_scroll.page_num&&jq(window).scrollTop()+jq(window).height()>=jq(document).height()-(jq(window).height()-(jq(window).height()*0.75))){wpcom_infinite_scroll.spinner();if(wpcom_infinite_scroll.page_html.length)
wpcom_infinite_scroll.render();else{wpcom_infinite_scroll.load(function(){wpcom_infinite_scroll.render();});}}},load:function(callback){if(wpcom_infinite_scroll.request!=false)
return true;var template=jq('#reader .sidebar ul li a.selected:first').attr('rel');if('subscriptions.read.topic'==template){var id=jq('#reader .sidebar ul li a.selected:first').attr('id').split('-');id=id[1];template+='.'+id;}
wpcom_infinite_scroll.request=jq.get('/wp-admin/admin-ajax.php',{'action':'wpcom_load_template','template':template,'per_page':wpcom_infinite_scroll.per_page,'page_num':wpcom_infinite_scroll.page_num},function(result){wpcom_infinite_scroll.page_html=result;if(typeof callback=='function')callback.call(this);wpcom_infinite_scroll.request=false;});},render:function(){if(jq('#subs-content h3.loading').length){jq('#subs-content').fadeOut(100,function(){jq('#subs-content').html(wpcom_infinite_scroll.page_html);jq('#subs-content').fadeIn(100,function(){wpcom_infinite_scroll.page_html=false;});});}
else{if(wpcom_infinite_scroll.page_html.search('<p class="noblogs">')>0){wpcom_infinite_scroll.page_num=false;jq('#subs-loading').html('Sorry, there are no more posts to read but you can always check out <a class="load-tab" rel="fresh" href="http://wordpress.com/fresh">freshly pressed</a>!');return false;}
jq('#subs-content').append(wpcom_infinite_scroll.page_html);jq('#subs-loading').remove();wp_remote_avatar_fetch();wpcom_infinite_scroll.page_html=false;}
wpcom_infinite_scroll.page_num++;wpcom_infinite_scroll.load();wpcom_homedash.quantcast('infinite_scroll');},spinner:function(){if(!jq('#subs-loading').length){jq('div.subscriptions:last-child').after('<div id="subs-loading"><span>Loading</span> Wait, there\'s more!</div>');jq('#subs-loading').hide().fadeIn('fast');}},unload:function(){jq(window).unbind('scroll.wpcom_infinite_scroll');if(typeof wpcom_infinite_scroll.request=='object')
wpcom_infinite_scroll.request.abort();wpcom_infinite_scroll.page_html=false;}}
var wpcom_tags_tab={init:function(){jq('div#my-tags a').attr('target','_blank');jq('#search-tags input[type=button]').live('click.wpcom_tags_tab',function(e){e.preventDefault();wpcom_tags_tab.load_tab_page();});jq('#tag-search-input').live('keyup.wpcom_tags_tab',function(e){var code=(e.keyCode?e.keyCode:e.which);if(e.type=='keyup'&&code!=13)
return false;wpcom_tags_tab.load_tab_page();return false;});},load_tab_page:function(){var val=jq("#tag-search-input").val();if(''!=val){jq('#search-tags input[type=button]').val('Searching...');location.href='http://en.wordpress.com/tag/'+val;}}}
jq(function(){var page=jq.query.get('page');var search=jq.query.get('search');jq('#tab-content div.wpl-post').css('max-height','340px');jq('#tab-content a.expander').live('click',function(){jq(this).parents('div.grad').css('background','none');jq(this).parents('div.wpl-post').css('max-height','');jq(this).parents('div.wpl-post').css('padding-bottom','30px');jq(this).remove();});jq('#tab-content #wpl-search-form').live('submit',function(){jq(this).addClass('loading');if(jq.query.get('page'))
var page=jq.query.get('page');else
var page=1;var search=jq('#wpl-search').val();jq.get('/wp-admin/admin-ajax.php',{'action':'like_search','search':search,'page':page},function(result){if(result.length){jq('#wpl-post-data').fadeOut(100,function(){jq('#search-term-bar').hide().slideDown();jq('#tab-content').html('<div>'+result+'</div>');jq(this).fadeIn(100);});jq('#wpl-search-form').removeClass('loading');jq.query.set('search',jq('#wpl-search').val());}});return false;});jq('#tab-content div.pagination a').live('click',function(){jq(this).parent().addClass('loading');if('Search Posts I Like'!=jq('#wpl-search').val())
var search=jq('#wpl-search').val();var page=jq(this).html();if(jq(this).hasClass('prev'))var page=Number(jq('div.pagination span.current').html())-1;if(jq(this).hasClass('next'))var page=Number(jq('div.pagination span.current').html())+1;jq.get('/wp-admin/admin-ajax.php',{'action':'like_pagination','search':search,'page':page},function(result){if(result.length){jq('#wpl-post-data').fadeOut(100,function(){jq('#tab-content').html('<div>'+result+'</div>');jq(this).fadeIn(100);});jq.scrollTo(jq('body'),500,{easing:'easeout'});jq('a.page-numbers').parent().removeClass('loading');}});return false;});jq('#tab-content a#clear').live('click',function(){jq(this).html('Clearing...');jq.get('/wp-admin/admin-ajax.php',{'action':'like_search','search':'','page':''},function(result){if(result.length){jq('#wpl-post-data').fadeOut(100,function(){jq('#search-term-bar').hide().slideDown();jq('#tab-content').html('<div>'+result+'</div>');jq(this).fadeIn(100);});jq('#wpl-search-form').removeClass('loading');}});return false;});jq('#tab-content a.remove').live('click',function(){var link=jq(this);link.html('Removing...');var nonce=link.attr('href').split('_wpnonce=');nonce=nonce[1];jq.get('/wp-admin/admin-ajax.php',{'action':'like_remove','ids':link.attr('id').substr(2,link.attr('id').length),'_wpnonce':nonce},function(result){if(1==result)
link.parents('div.wpl-post').slideUp(100);else
link.html('Error Removing.');});return false;});});jq(function(){jq('#tab-content #post_title').focus();jq('#tab-content p.submit input[type=submit]').live('click',function(){jq('p.submit').addClass('loading');var post_status=jq(this).attr('id');jq.get('/wp-admin/admin-ajax.php',{'action':'json_quickpress_post','cookie':encodeURIComponent(document.cookie),'post_title':jq('#post_title').val(),'content':jq('#content').val(),'post_tags':jq('#tags-input').val(),'blogid':jq('#blogid').val(),'ids':jq('input#reblog').val(),'status':post_status,'_wpnonce':jq('#_wpnonce').val()},function(result){if('success'==result.type){jq('#post_title').val('');jq('#content').val('');jq('#tags-input').val('');jq('#reblog').val('');jq('#reblogging-post').slideUp(100);jq('input#post_title').focus();jq('label#lcontent span').html('Content (required)');}
jq.scrollTo(jq('body'),500,{easing:'easeout'});jq('div#message').remove();jq('label#ltitle').before(result.message);jq('div#message').hide().slideDown();jq('p.submit').removeClass('loading');},'json');return false;});if(jq.query.get('title').length){jq('input#post_title').val(jq.query.get('title'));jq.query.REMOVE('title');}
if(jq.query.get('content').length){jq('textarea#content').val(jq.query.get('content'));jq.query.REMOVE('content');}
if(jq.query.get('tagit').length){jq('input#tags-input').val(jq.query.get('tagit'));jq.query.REMOVE('tagit');}
jq('select#blogid option[value="'+jq.query.get('blogid')+'"]').attr('selected','selected');jq.query.REMOVE('blogid');});function wpcom_populate_reblog(){var ids=jq.query.get('reblog');jq.get('/wp-admin/admin-ajax.php',{'action':'json_reblog','cookie':encodeURIComponent(document.cookie),'ids':ids},function(post){if(!post.post_title.length)
return false;jq('body').append('<div id="t_blog_name"></div><div id="t_post_title"</div>');jq('#t_blog_name').html(post.blog_name);jq('#t_post_title').html(post.post_title);jq('input#post_title').val(jq('#t_post_title').html()+' (via '+jq('#t_blog_name').html()+')');jq('label#lcontent span').html('Your Comments');jq('#reblogging-post h4').html(post.post_title);jq('#reblogging-post p').html(post.reblog_content);jq('#reblogging-post').slideDown(100);jq('#reblog').val(ids);jq('input#tags-input').val(post.post_tags);jq('textarea#content').focus();jq('#t_blog_name').remove();jq('#t_post_title').remove();},'json');jq.query.REMOVE('reblog');}
function wp_remote_avatar_fetch(){var images=jq("img[src='https://en.wordpress.com/wp-content/themes/h4/i/subs-rss.png'], img[src='https://s-ssl.wordpress.com/wp-content/themes/h4/i/subs-rss.png']");var rels=[];jq.each(images,function(i,el){if(-1!=jq.inArray(jq(el).attr('rel'),rels))
return;jq.get('/wp-admin/admin-ajax.php',{'action':'fill_avatars','blog_url':jq(el).attr('rel')},function(response){if('-1'!=response&&''!=response){jq("img[rel='"+jq(el).attr('rel')+"']").fadeOut('fast',function(){jq("img[rel='"+jq(el).attr('rel')+"']").attr('src',response);jq("img[rel='"+jq(el).attr('rel')+"']").fadeIn('fast');});}});rels.push(jq(el).attr('rel'));});}
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('(n(d){d.Y([\'z\',\'K\',\'U\',\'V\',\'Z\',\'6\',\'W\'],n(i,c){d.5.I[c]=n(5){b(!5.A){5.f=C(5.e,c);5.m=p(5.m);5.A=G}5.e.D[c]="v("+[g.o(g.t(7((5.w*(5.m[0]-5.f[0]))+5.f[0]),u),0),g.o(g.t(7((5.w*(5.m[1]-5.f[1]))+5.f[1]),u),0),g.o(g.t(7((5.w*(5.m[2]-5.f[2]))+5.f[2]),u),0)].J(",")+")"}});n p(6){y 4;b(6&&6.H==F&&6.E==3)8 6;b(4=/v\\(\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*,\\s*([0-9]{1,3})\\s*\\)/.l(6))8[7(4[1]),7(4[2]),7(4[3])];b(4=/v\\(\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*,\\s*([0-9]+(?:\\.[0-9]+)?)\\%\\s*\\)/.l(6))8[r(4[1])*2.q,r(4[2])*2.q,r(4[3])*2.q];b(4=/#([a-h-k-9]{2})([a-h-k-9]{2})([a-h-k-9]{2})/.l(6))8[7(4[1],j),7(4[2],j),7(4[3],j)];b(4=/#([a-h-k-9])([a-h-k-9])([a-h-k-9])/.l(6))8[7(4[1]+4[1],j),7(4[2]+4[2],j),7(4[3]+4[3],j)];b(4=/X\\(0, 0, 0, 0\\)/.l(6))8 B[\'x\'];8 B[d.T(6).S()]}n C(e,c){y 6;N{6=d.M(e,c);b(6!=\'\'&&6!=\'x\'||d.L(e,"O"))P;c="z"}R(e=e.Q);8 p(6)}})(d);',62,62,'||||result|fx|color|parseInt|return|||if|attr|jQuery|elem|start|Math|fA||16|F0|exec|end|function|max|getRGB|55|parseFloat||min|255|rgb|pos|transparent|var|backgroundColor|colorInit|colors|getColor|style|length|Array|true|constructor|step|join|borderBottomColor|nodeName|curCSS|do|body|break|parentNode|while|toLowerCase|trim|borderLeftColor|borderRightColor|outlineColor|rgba|each|borderTopColor'.split('|'),0,{}))
;(function(d){var k=d.scrollTo=function(a,i,e){d(window).scrollTo(a,i,e)};k.defaults={axis:'xy',duration:parseFloat(d.fn.jq)>=1.3?0:1};k.window=function(a){return d(window)._scrollable()};d.fn._scrollable=function(){return this.map(function(){var a=this,i=!a.nodeName||d.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!i)return a;var e=(a.contentWindow||a).document||a.ownerDocument||a;return d.browser.safari||e.compatMode=='BackCompat'?e.body:e.documentElement})};d.fn.scrollTo=function(n,j,b){if(typeof j=='object'){b=j;j=0}if(typeof b=='function')b={onAfter:b};if(n=='max')n=9e9;b=d.extend({},k.defaults,b);j=j||b.speed||b.duration;b.queue=b.queue&&b.axis.length>1;if(b.queue)j/=2;b.offset=p(b.offset);b.over=p(b.over);return this._scrollable().each(function(){var q=this,r=d(q),f=n,s,g={},u=r.is('html,body');switch(typeof f){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(f)){f=p(f);break}f=d(f,this);case'object':if(f.is||f.style)s=(f=d(f)).offset()}d.each(b.axis.split(''),function(a,i){var e=i=='x'?'Left':'Top',h=e.toLowerCase(),c='scroll'+e,l=q[c],m=k.max(q,i);if(s){g[c]=s[h]+(u?0:l-r.offset()[h]);if(b.margin){g[c]-=parseInt(f.css('margin'+e))||0;g[c]-=parseInt(f.css('border'+e+'Width'))||0}g[c]+=b.offset[h]||0;if(b.over[h])g[c]+=f[i=='x'?'width':'height']()*b.over[h]}else{var o=f[h];g[c]=o.slice&&o.slice(-1)=='%'?parseFloat(o)/100*m:o}if(/^\d+$/.test(g[c]))g[c]=g[c]<=0?0:Math.min(g[c],m);if(!a&&b.queue){if(l!=g[c])t(b.onAfterFirst);delete g[c]}});t(b.onAfter);function t(a){r.animate(g,j,b.easing,a&&function(){a.call(this,n,b)})}}).end()};k.max=function(a,i){var e=i=='x'?'Width':'Height',h='scroll'+e;if(!d(a).is('html,body'))return a[h]-d(a)[e.toLowerCase()]();var c='client'+e,l=a.ownerDocument.documentElement,m=a.ownerDocument.body;return Math.max(l[h],m[h])-Math.min(l[c],m[c])};function p(a){return typeof a=='object'?a:{top:a,left:a}}})(jq);jq.extend(jq.easing,{easein:function(x,t,b,c,d){return c*(t/=d)*t+b},easeinout:function(x,t,b,c,d){if(t<d/2)return 2*c*t*t/(d*d)+b;var ts=t-d/2;return-2*c*ts*ts/(d*d)+2*c*ts/d+c/2+b},easeout:function(x,t,b,c,d){return-c*t*t/(d*d)+2*c*t/d+b},expoin:function(x,t,b,c,d){var flip=1;if(c<0){flip*=-1;c*=-1}return flip*(Math.exp(Math.log(c)/d*t))+b},expoout:function(x,t,b,c,d){var flip=1;if(c<0){flip*=-1;c*=-1}return flip*(-Math.exp(-Math.log(c)/d*(t-d))+c+1)+b},expoinout:function(x,t,b,c,d){var flip=1;if(c<0){flip*=-1;c*=-1}if(t<d/2)return flip*(Math.exp(Math.log(c/2)/(d/2)*t))+b;return flip*(-Math.exp(-2*Math.log(c/2)/d*(t-d))+c+1)+b},bouncein:function(x,t,b,c,d){return c-jq.easing['bounceout'](x,d-t,0,c,d)+b},bounceout:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b}},bounceinout:function(x,t,b,c,d){if(t<d/2)return jq.easing['bouncein'](x,t*2,0,c,d)*.5+b;return jq.easing['bounceout'](x,t*2-d,0,c,d)*.5+c*.5+b},elasin:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4}else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},elasout:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4}else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},elasinout:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4}else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b},backin:function(x,t,b,c,d){var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},backout:function(x,t,b,c,d){var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},backinout:function(x,t,b,c,d){var s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b},linear:function(x,t,b,c,d){return c*t/d+b}});jq.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}expires='; expires='+date.toUTCString();}var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jq.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}return cookieValue;}};new function(a){var b=a.separator||"&";var c=a.spaces===false?false:true;var d=a.suffix===false?"":"[]";var e=a.prefix===false?false:true;var f=e?a.hash===true?"#":"?":"";var g=a.numbers===false?false:true;jQuery.query=new function(){var a=function(a,b){return a!=undefined&&a!==null&&(!!b?a.constructor==b:true)};var d=function(a){var b,c=/\[([^[]*)\]/g,d=/^([^[]+)(\[.*\])?$/.exec(a),e=d[1],f=[];while(b=c.exec(d[2]))f.push(b[1]);return[e,f]};var e=function(b,c,d){var f,g=c.shift();if(typeof b!="object")b=null;if(g===""){if(!b)b=[];if(a(b,Array)){b.push(c.length==0?d:e(null,c.slice(0),d))}else if(a(b,Object)){var h=0;while(b[h++]!=null);b[--h]=c.length==0?d:e(b[h],c.slice(0),d)}else{b=[];b.push(c.length==0?d:e(null,c.slice(0),d))}}else if(g&&g.match(/^\s*[0-9]+\s*$/)){var i=parseInt(g,10);if(!b)b=[];b[i]=c.length==0?d:e(b[i],c.slice(0),d)}else if(g){var i=g.replace(/^\s*|\s*$/g,"");if(!b)b={};if(a(b,Array)){var j={};for(var h=0;h<b.length;++h){j[h]=b[h]}b=j}b[i]=c.length==0?d:e(b[i],c.slice(0),d)}else{return d}return b};var h=function(a){var b=this;b.keys={};if(a.queryObject){jQuery.each(a.get(),function(a,c){b.SET(a,c)})}else{jQuery.each(arguments,function(){var a=""+this;a=a.replace(/^[?#]/,"");a=a.replace(/[;&]$/,"");if(c)a=a.replace(/[+]/g," ");jQuery.each(a.split(/[&;]/),function(){var a=decodeURIComponent(this.split("=")[0]||"");var c=decodeURIComponent(this.split("=")[1]||"");if(!a)return;if(g){if(/^[+-]?[0-9]+\.[0-9]*$/.test(c))c=parseFloat(c);else if(/^[+-]?[0-9]+$/.test(c))c=parseInt(c,10)}c=!c&&c!==0?true:c;if(c!==false&&c!==true&&typeof c!="number")c=c;b.SET(a,c)})})}return b};h.prototype={queryObject:true,has:function(b,c){var d=this.get(b);return a(d,c)},GET:function(b){if(!a(b))return this.keys;var c=d(b),e=c[0],f=c[1];var g=this.keys[e];while(g!=null&&f.length!=0){g=g[f.shift()]}return typeof g=="number"?g:g||""},get:function(b){var c=this.GET(b);if(a(c,Object))return jQuery.extend(true,{},c);else if(a(c,Array))return c.slice(0);return c},SET:function(b,c){var f=!a(c)?null:c;var g=d(b),h=g[0],i=g[1];var j=this.keys[h];this.keys[h]=e(j,i.slice(0),f);return this},set:function(a,b){return this.copy().SET(a,b)},REMOVE:function(a){return this.SET(a,null).COMPACT()},remove:function(a){return this.copy().REMOVE(a)},EMPTY:function(){var a=this;jQuery.each(a.keys,function(b,c){delete a.keys[b]});return a},load:function(a){var b=a.replace(/^.*?[#](.+?)(?:\?.+)?$/,"$1");var c=a.replace(/^.*?[?](.+?)(?:#.+)?$/,"$1");return new h(a.length==c.length?"":c,a.length==b.length?"":b)},empty:function(){return this.copy().EMPTY()},copy:function(){return new h(this)},COMPACT:function(){function b(c){var d=typeof c=="object"?a(c,Array)?[]:{}:c;if(typeof c=="object"){function e(b,c,d){if(a(b,Array))b.push(d);else b[c]=d}jQuery.each(c,function(c,f){if(!a(f))return true;e(d,c,b(f))})}return d}this.keys=b(this.keys);return this},compact:function(){return this.copy().COMPACT()},toString:function(){var d=0,e=[],g=[],h=this;var i=function(a){a=a+"";if(c)a=a.replace(/ /g,"+");return encodeURIComponent(a)};var j=function(b,c,d){if(!a(d)||d===false)return;var e=[i(c)];if(d!==true){e.push("=");e.push(i(d))}b.push(e.join(""))};var k=function(a,b){var c=function(a){return!b||b==""?[a].join(""):[b,"[",a,"]"].join("")};jQuery.each(a,function(a,b){if(typeof b=="object")k(b,c(a));else j(g,c(a),b)})};k(this.keys);if(g.length>0)e.push(f);e.push(g.join(b));return e.join("")}};return new h(location.search,location.hash)}}(jQuery.query||{})